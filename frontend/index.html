<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý Nhà hàng - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary-color: #64748b;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --light-bg: #f8fafc;
      --card-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --border-radius: 12px;
    }

    * {
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .main-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      margin: 20px auto;
      max-width: 1400px;
    }

    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 2rem;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0.3;
    }

    .header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 2.5rem;
      position: relative;
      z-index: 1;
    }

    .header .subtitle {
      margin: 0.5rem 0 0 0;
      opacity: 0.9;
      font-size: 1.1rem;
      position: relative;
      z-index: 1;
    }

    .nav-tabs {
      border-bottom: none;
      background: var(--light-bg);
      padding: 1rem 2rem 0 2rem;
      margin: 0;
    }

    .nav-tabs .nav-link {
      border: none;
      border-radius: 8px 8px 0 0;
      padding: 1rem 1.5rem;
      font-weight: 500;
      color: var(--secondary-color);
      background: transparent;
      margin-right: 0.5rem;
      transition: all 0.3s ease;
    }

    .nav-tabs .nav-link:hover {
      background: white;
      color: var(--primary-color);
      transform: translateY(-2px);
    }

    .nav-tabs .nav-link.active {
      background: white;
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
      box-shadow: var(--card-shadow);
    }

    .tab-content {
      padding: 2rem;
      background: white;
    }

    .welcome-card {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: none;
      border-radius: var(--border-radius);
      padding: 3rem;
      text-align: center;
      box-shadow: var(--card-shadow);
    }

    .welcome-card h3 {
      color: var(--primary-color);
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .search-container {
      background: var(--light-bg);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      margin-bottom: 2rem;
      box-shadow: var(--card-shadow);
    }

    .search-input {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn-modern {
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      transition: all 0.3s ease;
      border: none;
    }

    .btn-primary-modern {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
    }

    .btn-primary-modern:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    }

    .table-container {
      background: white;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .table {
      margin: 0;
    }

    .table thead th {
      background: var(--light-bg);
      border: none;
      padding: 1rem;
      font-weight: 600;
      color: var(--secondary-color);
      text-transform: uppercase;
      font-size: 0.875rem;
      letter-spacing: 0.5px;
    }

    .table tbody tr {
      transition: all 0.3s ease;
    }

    .table tbody tr:hover {
      background: #f8fafc;
      transform: scale(1.01);
    }

    .table tbody td {
      padding: 1rem;
      border: none;
      border-bottom: 1px solid #f1f5f9;
      vertical-align: middle;
    }

    .form-container {
      background: var(--light-bg);
      padding: 2rem;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      font-weight: 500;
      color: var(--secondary-color);
      margin-bottom: 0.5rem;
    }

    .form-control-modern {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-control-modern:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .status-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .status-processing {
      background: #fef3c7;
      color: #92400e;
    }

    .status-paid {
      background: #d1fae5;
      color: #065f46;
    }

    .status-cancelled {
      background: #fee2e2;
      color: #991b1b;
    }

    .action-btn {
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.875rem;
      border: none;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      transform: translateY(-1px);
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--secondary-color);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .stats-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      text-align: center;
      margin-bottom: 2rem;
    }

    .stats-card .icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .stats-card .number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .stats-card .label {
      color: var(--secondary-color);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    @media (max-width: 768px) {
      .main-container {
        margin: 10px;
        border-radius: 8px;
      }
      
      .header {
        padding: 1.5rem;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .tab-content {
        padding: 1rem;
      }
      
      .nav-tabs {
        padding: 1rem 1rem 0 1rem;
      }
      
      .nav-tabs .nav-link {
        padding: 0.75rem 1rem;
        margin-right: 0.25rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="header">
      <h1><i class="fas fa-utensils me-3"></i>Quản lý Nhà hàng</h1>
      <p class="subtitle">Hệ thống quản lý hiện đại và chuyên nghiệp</p>
    </div>
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab">
          <i class="fas fa-home me-2"></i>Trang chủ
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="donhang-tab" data-bs-toggle="tab" data-bs-target="#donhang" type="button" role="tab">
          <i class="fas fa-list-alt me-2"></i>Danh sách đơn hàng
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="them-donhang-tab" data-bs-toggle="tab" data-bs-target="#them-donhang" type="button" role="tab">
          <i class="fas fa-plus-circle me-2"></i>Tạo đơn hàng
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="nguyenlieu-tab" data-bs-toggle="tab" data-bs-target="#nguyenlieu" type="button" role="tab">
          <i class="fas fa-warehouse me-2"></i>Nguyên liệu
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="congthuc-tab" data-bs-toggle="tab" data-bs-target="#congthuc" type="button" role="tab">
          <i class="fas fa-book me-2"></i>Công thức
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="nhanvien-tab" data-bs-toggle="tab" data-bs-target="#nhanvien" type="button" role="tab">
          <i class="fas fa-user-tie me-2"></i>Nhân viên
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="khachhang-tab" data-bs-toggle="tab" data-bs-target="#khachhang" type="button" role="tab">
          <i class="fas fa-users me-2"></i>Khách hàng
        </button>
      </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="home" role="tabpanel">
        <div class="welcome-card">
          <h3><i class="fas fa-chart-line me-2"></i>Dashboard Tổng quan</h3>
          <p class="text-muted mb-4">Chào mừng bạn đến với hệ thống quản lý nhà hàng. Theo dõi và quản lý đơn hàng một cách hiệu quả.</p>
        </div>
        
        <div class="row mt-4">
          <div class="col-md-4">
            <div class="stats-card">
              <div class="icon text-primary">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <div class="number text-primary">156</div>
              <div class="label">Đơn hàng hôm nay</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stats-card">
              <div class="icon text-success">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="number text-success">12.5M</div>
              <div class="label">Doanh thu (VNĐ)</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="stats-card">
              <div class="icon text-warning">
                <i class="fas fa-clock"></i>
              </div>
              <div class="number text-warning">23</div>
              <div class="label">Đơn đang xử lý</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="tab-pane fade" id="donhang" role="tabpanel">
        <div class="search-container">
          <div class="row align-items-end">
            <div class="col-md-10">
              <label class="form-label"><i class="fas fa-search me-2"></i>Tìm kiếm đơn hàng</label>
              <input type="text" id="searchInput" class="form-control search-input" placeholder="Nhập mã đơn hàng, tên khách hàng...">
            </div>
            <div class="col-md-2">
              <button id="searchBtn" class="btn btn-primary-modern btn-modern w-100">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
            </div>
          </div>
        </div>
        
        <div id="donHangList" class="table-container">
          <!-- Danh sách đơn hàng sẽ được hiển thị ở đây -->
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h5>Đang tải danh sách đơn hàng...</h5>
            <p>Vui lòng đợi trong giây lát</p>
          </div>
        </div>
      </div>
      
      <div class="tab-pane fade" id="them-donhang" role="tabpanel">
        <div class="form-container">
          <h4 class="mb-4"><i class="fas fa-plus-circle me-2"></i>Tạo đơn hàng mới</h4>
          <form id="donHangForm">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="ngayLap" class="form-label"><i class="fas fa-calendar me-2"></i>Ngày lập</label>
                  <input type="date" class="form-control form-control-modern" id="ngayLap" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="maKhachHang" class="form-label"><i class="fas fa-user me-2"></i>Mã khách hàng</label>
                  <input type="text" class="form-control form-control-modern" id="maKhachHang" placeholder="Để trống nếu là khách vãng lai">
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="maNhanVien" class="form-label"><i class="fas fa-id-badge me-2"></i>Mã nhân viên</label>
                  <input type="text" class="form-control form-control-modern" id="maNhanVien" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="maBan" class="form-label"><i class="fas fa-chair me-2"></i>Mã bàn</label>
                  <input type="text" class="form-control form-control-modern" id="maBan" required>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="tongTien" class="form-label"><i class="fas fa-money-bill me-2"></i>Tổng tiền (VNĐ)</label>
                  <input type="number" class="form-control form-control-modern" id="tongTien" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="trangThai" class="form-label"><i class="fas fa-info-circle me-2"></i>Trạng thái</label>
                  <select class="form-select form-control-modern" id="trangThai" required>
                    <option value="Đang xử lý">Đang xử lý</option>
                    <option value="Đã thanh toán">Đã thanh toán</option>
                    <option value="Đã hủy">Đã hủy</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="ghiChu" class="form-label"><i class="fas fa-sticky-note me-2"></i>Ghi chú</label>
              <textarea class="form-control form-control-modern" id="ghiChu" rows="3" placeholder="Nhập ghi chú cho đơn hàng..."></textarea>
            </div>
            
            <div class="text-center">
              <button type="submit" class="btn btn-primary-modern btn-modern btn-lg px-5">
                <i class="fas fa-save me-2"></i>Tạo đơn hàng
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- Thêm vào phần tab-content -->
      <div class="tab-pane fade" id="nguyenlieu" role="tabpanel">
        <div class="search-container">
          <div class="row align-items-end">
            <div class="col-md-8">
              <label class="form-label"><i class="fas fa-search me-2"></i>Tìm kiếm nguyên liệu</label>
              <input type="text" id="searchNguyenLieuInput" class="form-control search-input" placeholder="Nhập tên nguyên liệu, đơn vị...">
            </div>
            <div class="col-md-2">
              <button id="searchNguyenLieuBtn" class="btn btn-primary-modern btn-modern w-100">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
            </div>
            <div class="col-md-2">
              <button class="btn btn-success btn-modern w-100" data-bs-toggle="modal" data-bs-target="#addNguyenLieuModal">
                <i class="fas fa-plus me-2"></i>Thêm mới
              </button>
            </div>
          </div>
        </div>
        
        <div id="nguyenLieuList" class="table-container">
          <div class="empty-state">
            <i class="fas fa-spinner fa-spin"></i>
            <h5>Đang tải danh sách nguyên liệu...</h5>
          </div>
        </div>
      </div>
      <!--<div class="tab-pane fade" id="congthuc" role="tabpanel">
        <div class="search-container">
          <div class="row align-items-end">
            <div class="col-md-8">
              <label class="form-label"><i class="fas fa-search me-2"></i>Tìm kiếm công thức</label>
              <input type="text" id="searchCongThucInput" class="form-control search-input" placeholder="Nhập tên công thức, món ăn...">
            </div>
            <div class="col-md-2">
              <button id="searchCongThucBtn" class="btn btn-primary-modern btn-modern w-100">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
            </div>
            <div class="col-md-2">
              <button class="btn btn-success btn-modern w-100" data-bs-toggle="modal" data-bs-target="#addCongThucModal">
                <i class="fas fa-plus me-2"></i>Thêm mới
              </button>
            </div>
          </div>
        </div>
        
        <div id="congThucList" class="table-container">
          <div class="empty-state">
            <i class="fas fa-spinner fa-spin"></i>
            <h5>Đang tải danh sách công thức...</h5>
          </div>
        </div>
      </div>-->
      <div class="tab-pane fade" id="nhanvien" role="tabpanel">
        <div class="search-container">
          <div class="row align-items-end">
            <div class="col-md-8">
              <label class="form-label"><i class="fas fa-search me-2"></i>Tìm kiếm nhân viên</label>
              <input type="text" id="searchNhanVienInput" class="form-control search-input" placeholder="Nhập tên, mã nhân viên...">
            </div>
            <div class="col-md-2">
              <button id="searchNhanVienBtn" class="btn btn-primary-modern btn-modern w-100">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
            </div>
            <div class="col-md-2">
              <button class="btn btn-success btn-modern w-100" data-bs-toggle="modal" data-bs-target="#addNhanVienModal">
                <i class="fas fa-plus me-2"></i>Thêm mới
              </button>
            </div>
          </div>
        </div>
        
        <div id="nhanVienList" class="table-container">
          <div class="empty-state">
            <i class="fas fa-spinner fa-spin"></i>
            <h5>Đang tải danh sách nhân viên...</h5>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="khachhang" role="tabpanel">
        <div class="search-container">
          <div class="row align-items-end">
            <div class="col-md-8">
              <label class="form-label"><i class="fas fa-search me-2"></i>Tìm kiếm khách hàng</label>
              <input type="text" id="searchKhachHangInput" class="form-control search-input" placeholder="Nhập tên, số điện thoại...">
            </div>
            <div class="col-md-2">
              <button id="searchKhachHangBtn" class="btn btn-primary-modern btn-modern w-100">
                <i class="fas fa-search me-2"></i>Tìm kiếm
              </button>
            </div>
            <div class="col-md-2">
              <button class="btn btn-success btn-modern w-100" data-bs-toggle="modal" data-bs-target="#addKhachHangModal">
                <i class="fas fa-plus me-2"></i>Thêm mới
              </button>
            </div>
          </div>
        </div>
        
        <div id="khachHangList" class="table-container">
          <div class="empty-state">
            <i class="fas fa-spinner fa-spin"></i>
            <h5>Đang tải danh sách khách hàng...</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Thiết lập ngày hiện tại cho input date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('ngayLap').value = today;
      
      // Lấy danh sách đơn hàng khi trang được tải
      loadDonHangList();
      
      // Xử lý tìm kiếm
      document.getElementById('searchBtn').addEventListener('click', function() {
        const keyword = document.getElementById('searchInput').value;
        searchDonHang(keyword);
      });
      
      // Xử lý tìm kiếm khi nhấn Enter
      document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          const keyword = this.value;
          searchDonHang(keyword);
        }
      });
      
      // Xử lý form tạo đơn hàng
      document.getElementById('donHangForm').addEventListener('submit', function(e) {
        e.preventDefault();
        createDonHang();
      });
    });

    // Hàm tải danh sách đơn hàng
    async function loadDonHangList() {
      try {
        const response = await fetch('http://localhost:3000/api/donhang');
        if (!response.ok) {
          throw new Error('Không thể tải danh sách đơn hàng');
        }
        const donHangs = await response.json();
        displayDonHangList(donHangs);
      } catch (error) {
        console.error('Lỗi khi tải danh sách đơn hàng:', error);
        displayError('Không thể tải danh sách đơn hàng');
      }
    }

    // Hàm hiển thị danh sách đơn hàng
    function displayDonHangList(donHangs) {
      const donHangListElement = document.getElementById('donHangList');
      donHangListElement.innerHTML = '';
      
      if (!donHangs || donHangs.length === 0) {
        donHangListElement.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h5>Không có đơn hàng nào</h5>
            <p>Chưa có đơn hàng nào được tạo hoặc không tìm thấy kết quả phù hợp</p>
          </div>
        `;
        return;
      }
      
      const table = document.createElement('table');
      table.className = 'table table-hover';
      
      // Tạo header bảng
      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr>
          <th><i class="fas fa-hashtag me-2"></i>Mã đơn hàng</th>
          <th><i class="fas fa-calendar me-2"></i>Ngày lập</th>
          <th><i class="fas fa-user me-2"></i>Khách hàng</th>
          <th><i class="fas fa-money-bill me-2"></i>Tổng tiền</th>
          <th><i class="fas fa-info-circle me-2"></i>Trạng thái</th>
          <th><i class="fas fa-cogs me-2"></i>Hành động</th>
        </tr>
      `;
      table.appendChild(thead);
      
      // Tạo body bảng
      const tbody = document.createElement('tbody');
      donHangs.forEach(donHang => {
        const tr = document.createElement('tr');
        
        // Xác định class cho status badge
        let statusClass = 'status-processing';
        if (donHang.TrangThai === 'Đã thanh toán') statusClass = 'status-paid';
        if (donHang.TrangThai === 'Đã hủy') statusClass = 'status-cancelled';
        
        tr.innerHTML = `
          <td><strong>${donHang.MaDonHang}</strong></td>
          <td>${new Date(donHang.NgayLap).toLocaleDateString('vi-VN')}</td>
          <td>${donHang.MaKhachHang || '<span class="text-muted">Khách vãng lai</span>'}</td>
          <td><strong>${donHang.TongTien.toLocaleString('vi-VN')} VNĐ</strong></td>
          <td><span class="status-badge ${statusClass}">${donHang.TrangThai}</span></td>
          <td>
            <button class="btn btn-info action-btn" onclick="viewDonHangDetail('${donHang.MaDonHang}')">
              <i class="fas fa-eye me-1"></i>Chi tiết
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      donHangListElement.appendChild(table);
    }

    // Hàm tìm kiếm đơn hàng
    async function searchDonHang(keyword) {
      try {
        const response = await fetch(`http://localhost:3000/api/donhang/search?q=${encodeURIComponent(keyword)}`);
        if (!response.ok) {
          throw new Error('Lỗi khi tìm kiếm đơn hàng');
        }
        const results = await response.json();
        displayDonHangList(results);
      } catch (error) {
        console.error('Lỗi khi tìm kiếm đơn hàng:', error);
        displayError('Lỗi khi tìm kiếm');
      }
    }

    // Hàm tạo đơn hàng mới
    async function createDonHang() {
      const newDonHang = {
        NgayLap: document.getElementById('ngayLap').value,
        MaKhachHang: document.getElementById('maKhachHang').value || null,
        MaNhanVien: document.getElementById('maNhanVien').value,
        MaBan: document.getElementById('maBan').value,
        TongTien: parseFloat(document.getElementById('tongTien').value),
        TrangThai: document.getElementById('trangThai').value,
        GhiChu: document.getElementById('ghiChu').value
      };
      
      // Kiểm tra dữ liệu đầu vào
      if (!newDonHang.NgayLap || !newDonHang.MaNhanVien || 
          !newDonHang.MaBan || !newDonHang.TongTien || newDonHang.TongTien <= 0) {
        showErrorMessage('Vui lòng điền đầy đủ thông tin và tổng tiền phải lớn hơn 0');
        return;
      }
      
      try {
        const response = await fetch('http://localhost:3000/api/donhang', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(newDonHang)
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Lỗi khi tạo đơn hàng');
        }
        
        const result = await response.json();
        showSuccessMessage('Tạo đơn hàng thành công!');
        document.getElementById('donHangForm').reset();
        document.getElementById('ngayLap').value = new Date().toISOString().split('T')[0];
        loadDonHangList();
        
        // Chuyển sang tab danh sách đơn hàng
        const donhangTab = document.querySelector('#donhang-tab');
        new bootstrap.Tab(donhangTab).show();
      } catch (error) {
        console.error('Lỗi khi tạo đơn hàng:', error);
        showErrorMessage(error.message || 'Đã xảy ra lỗi khi tạo đơn hàng');
      }
    }

    // Hàm xem chi tiết đơn hàng
    async function viewDonHangDetail(maDonHang) {
      try {
        showInfoMessage(`Đang tải chi tiết đơn hàng ${maDonHang}...`);
        
        const response = await fetch(`http://localhost:3000/api/donhang/${maDonHang}`);
        if (!response.ok) {
          throw new Error('Không thể lấy chi tiết đơn hàng');
        }
        
        const donHang = await response.json();
        
        const detailHtml = `
          <div>
            <h5>Chi tiết đơn hàng ${donHang.MaDonHang}</h5>
            <p><strong>Ngày lập:</strong> ${new Date(donHang.NgayLap).toLocaleDateString('vi-VN')}</p>
            <p><strong>Khách hàng:</strong> ${donHang.MaKhachHang || 'Khách vãng lai'}</p>
            <p><strong>Nhân viên:</strong> ${donHang.MaNhanVien}</p>
            <p><strong>Bàn:</strong> ${donHang.MaBan}</p>
            <p><strong>Tổng tiền:</strong> ${donHang.TongTien.toLocaleString('vi-VN')} VNĐ</p>
            <p><strong>Trạng thái:</strong> <span class="status-badge ${getStatusClass(donHang.TrangThai)}">${donHang.TrangThai}</span></p>
            <p><strong>Ghi chú:</strong> ${donHang.GhiChu || 'Không có ghi chú'}</p>
          </div>
        `;
        
        const modalContent = document.getElementById('donHangDetailContent');
        if (modalContent) {
          modalContent.innerHTML = detailHtml;
          const detailModal = new bootstrap.Modal(document.getElementById('donHangDetailModal'));
          detailModal.show();
        }
      } catch (error) {
        console.error('Lỗi khi lấy chi tiết đơn hàng:', error);
        showErrorMessage('Không thể tải chi tiết đơn hàng');
      }
    }

    // Hàm xác định class cho trạng thái
    function getStatusClass(status) {
      if (status === 'Đã thanh toán') return 'status-paid';
      if (status === 'Đã hủy') return 'status-cancelled';
      return 'status-processing';
    }

    // Hàm hiển thị thông báo thành công
    function showSuccessMessage(message) {
      const alertHtml = `
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="fas fa-check-circle me-2"></i>${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      displayAlert(alertHtml);
    }

    // Hàm hiển thị thông báo lỗi
    function showErrorMessage(message) {
      const alertHtml = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="fas fa-exclamation-circle me-2"></i>${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      displayAlert(alertHtml);
    }

    // Hàm hiển thị thông báo thông tin
    function showInfoMessage(message) {
      const alertHtml = `
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          <i class="fas fa-info-circle me-2"></i>${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
      displayAlert(alertHtml);
    }

    // Hiển thị thông báo ở đầu tab-content
    function displayAlert(alertHtml) {
      const alertContainer = document.getElementById('alertContainer');
      if (!alertContainer) {
        // Tạo container nếu chưa có
        const container = document.createElement('div');
        container.id = 'alertContainer';
        container.className = 'container mt-3';
        document.querySelector('.tab-content').prepend(container);
      }
      
      document.getElementById('alertContainer').innerHTML = alertHtml;
      
      // Tự động ẩn sau 5 giây
      setTimeout(() => {
        const alertEl = document.querySelector('.alert');
        if (alertEl) {
          const bsAlert = new bootstrap.Alert(alertEl);
          bsAlert.close();
        }
      }, 5000);
    }

    // Hàm hiển thị lỗi
    function displayError(message) {
      const donHangListElement = document.getElementById('donHangList');
      donHangListElement.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-exclamation-triangle text-danger"></i>
          <h5>${message}</h5>
          <p>Vui lòng thử lại sau hoặc liên hệ quản trị viên</p>
          <button class="btn btn-primary-modern btn-modern mt-3" onclick="loadDonHangList()">
            <i class="fas fa-sync-alt me-2"></i>Tải lại
          </button>
        </div>
      `;
    }
      // ==================== QUẢN LÝ NGUYÊN LIỆU ====================
  document.getElementById('nguyenlieu-tab').addEventListener('shown.bs.tab', function() {
    loadNguyenLieuList();
  });

  document.getElementById('searchNguyenLieuBtn').addEventListener('click', function() {
    const keyword = document.getElementById('searchNguyenLieuInput').value;
    searchNguyenLieu(keyword);
  });

  document.getElementById('saveNguyenLieuBtn').addEventListener('click', function() {
    saveNguyenLieu();
  });

  async function loadNguyenLieuList() {
    try {
      const response = await fetch('http://localhost:3000/api/nguyenlieu');
      if (!response.ok) throw new Error('Không thể tải danh sách');
      const nguyenLieus = await response.json();
      displayNguyenLieuList(nguyenLieus);
    } catch (error) {
      console.error('Lỗi tải nguyên liệu:', error);
      displayNguyenLieuError('Không thể tải danh sách nguyên liệu');
    }
  }

  function displayNguyenLieuList(nguyenLieus) {
    const container = document.getElementById('nguyenLieuList');
    if (!nguyenLieus || nguyenLieus.length === 0) {
      container.innerHTML = `<div class="empty-state"><i class="fas fa-box-open"></i><h5>Không có nguyên liệu nào</h5></div>`;
      return;
    }
    
    let tableHTML = `
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Mã</th>
            <th>Tên nguyên liệu</th>
            <th>Số lượng</th>
            <th>Đơn vị</th>
            <th>Giá nhập</th>
            <th>Hạn sử dụng</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    nguyenLieus.forEach(nl => {
      // Kiểm tra số lượng cảnh báo
      let rowClass = '';
      let quantityWarning = '';
      if (nl.SoLuong < 10) {
        rowClass = 'table-warning';
        quantityWarning = '<i class="fas fa-exclamation-triangle text-danger"></i> ';
      }
      
      tableHTML += `
        <tr class="${rowClass}">
          <td>${nl.MaNguyenLieu}</td>
          <td>${nl.Ten}</td>
          <td>${quantityWarning}${nl.SoLuong}</td>
          <td>${nl.DonVi}</td>
          <td>${nl.GiaNhap.toLocaleString('vi-VN')} VNĐ</td>
          <td>${nl.HanSuDung ? new Date(nl.HanSuDung).toLocaleDateString('vi-VN') : 'N/A'}</td>
          <td>
            <button class="btn btn-sm btn-info me-1" onclick="editNguyenLieu('${nl.MaNguyenLieu}')">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger" onclick="deleteNguyenLieu('${nl.MaNguyenLieu}')">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    });
    
    tableHTML += `</tbody></table>`;
    container.innerHTML = tableHTML;
  }

  async function searchNguyenLieu(keyword) {
    try {
      const response = await fetch(`http://localhost:3000/api/nguyenlieu/search?q=${encodeURIComponent(keyword)}`);
      if (!response.ok) throw new Error('Lỗi tìm kiếm');
      const results = await response.json();
      displayNguyenLieuList(results);
    } catch (error) {
      console.error('Lỗi tìm kiếm:', error);
      showErrorMessage('Lỗi tìm kiếm nguyên liệu');
    }
  }

  async function editNguyenLieu(id) {
    try {
      const response = await fetch(`http://localhost:3000/api/nguyenlieu/${id}`);
      if (!response.ok) throw new Error('Không tìm thấy nguyên liệu');
      const nl = await response.json();
      
      // Điền form
      document.getElementById('nguyenLieuId').value = nl.MaNguyenLieu;
      document.getElementById('tenNguyenLieu').value = nl.Ten;
      document.getElementById('soLuong').value = nl.SoLuong;
      document.getElementById('donVi').value = nl.DonVi;
      document.getElementById('giaNhap').value = nl.GiaNhap;
      document.getElementById('hanSuDung').value = nl.HanSuDung ? nl.HanSuDung.split('T')[0] : '';
      document.getElementById('ghiChuNL').value = nl.GhiChu || '';
      
      // Đổi tiêu đề modal
      document.getElementById('nguyenLieuModalTitle').textContent = `Sửa nguyên liệu ${nl.Ten}`;
      
      // Mở modal
      const modal = new bootstrap.Modal(document.getElementById('addNguyenLieuModal'));
      modal.show();
    } catch (error) {
      console.error('Lỗi khi sửa:', error);
      showErrorMessage('Không thể mở thông tin nguyên liệu');
    }
  }

  async function saveNguyenLieu() {
    const nguyenLieuId = document.getElementById('nguyenLieuId').value;
    const isEditMode = !!nguyenLieuId;
    
    const nguyenLieu = {
      Ten: document.getElementById('tenNguyenLieu').value,
      SoLuong: parseInt(document.getElementById('soLuong').value),
      DonVi: document.getElementById('donVi').value,
      GiaNhap: parseFloat(document.getElementById('giaNhap').value),
      HanSuDung: document.getElementById('hanSuDung').value || null,
      GhiChu: document.getElementById('ghiChuNL').value
    };
    
    // Kiểm tra dữ liệu
    if (!nguyenLieu.Ten || !nguyenLieu.SoLuong || !nguyenLieu.DonVi || !nguyenLieu.GiaNhap) {
      showErrorMessage('Vui lòng điền đầy đủ thông tin bắt buộc');
      return;
    }
    
    try {
      let response;
      if (isEditMode) {
        response = await fetch(`http://localhost:3000/api/nguyenlieu/${nguyenLieuId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(nguyenLieu)
        });
      } else {
        response = await fetch('http://localhost:3000/api/nguyenlieu', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(nguyenLieu)
        });
      }
      
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.message || 'Lỗi khi lưu');
      }
      
      // Đóng modal và làm mới danh sách
      const modal = bootstrap.Modal.getInstance(document.getElementById('addNguyenLieuModal'));
      modal.hide();
      showSuccessMessage(`Nguyên liệu đã được ${isEditMode ? 'cập nhật' : 'thêm mới'} thành công!`);
      loadNguyenLieuList();
    } catch (error) {
      console.error('Lỗi khi lưu:', error);
      showErrorMessage(error.message || 'Lỗi khi lưu nguyên liệu');
    }
  }

  async function deleteNguyenLieu(id) {
    if (!confirm('Bạn có chắc chắn muốn xóa nguyên liệu này?')) return;
    
    try {
      const response = await fetch(`http://localhost:3000/api/nguyenlieu/${id}`, {
        method: 'DELETE'
      });
      
      if (!response.ok) throw new Error('Xóa không thành công');
      
      showSuccessMessage('Đã xóa nguyên liệu thành công!');
      loadNguyenLieuList();
    } catch (error) {
      console.error('Lỗi khi xóa:', error);
      showErrorMessage('Không thể xóa nguyên liệu');
    }
  }

  // ==================== QUẢN LÝ CÔNG THỨC ====================
  document.getElementById('congthuc-tab').addEventListener('shown.bs.tab', function() {
    loadCongThucList();
    loadMatHangOptions();
    loadNguyenLieuOptions();
  });

  document.getElementById('addNguyenLieuBtn').addEventListener('click', function() {
    addNguyenLieuItem();
  });

  document.getElementById('saveCongThucBtn').addEventListener('click', function() {
    saveCongThuc();
  });

  function addNguyenLieuItem() {
    const container = document.getElementById('nguyenLieuContainer');
    const newItem = document.createElement('div');
    newItem.className = 'row mb-3 nguyen-lieu-item';
    newItem.innerHTML = `
      <div class="col-md-5">
        <select class="form-select form-control-modern nguyen-lieu-select">
          <option value="">Chọn nguyên liệu</option>
          ${getNguyenLieuOptions()}
        </select>
      </div>
      <div class="col-md-3">
        <input type="number" class="form-control form-control-modern so-luong" min="0.01" step="0.01" placeholder="Số lượng">
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control form-control-modern don-vi" placeholder="Đơn vị">
      </div>
      <div class="col-md-1">
        <button type="button" class="btn btn-danger btn-sm remove-item">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    `;
    container.appendChild(newItem);
    
    // Thêm sự kiện xóa
    newItem.querySelector('.remove-item').addEventListener('click', function() {
      this.closest('.nguyen-lieu-item').remove();
    });
  }

  function getNguyenLieuOptions() {
    // Lấy dữ liệu nguyên liệu đã tải trước đó
    if (!window.nguyenLieus) return '';
    
    return window.nguyenLieus.map(nl => 
      `<option value="${nl.MaNguyenLieu}">${nl.Ten} (${nl.DonVi})</option>`
    ).join('');
  }

  async function loadMatHangOptions() {
    try {
      const response = await fetch('http://localhost:3000/api/mathang');
      if (!response.ok) return;
      
      const matHangs = await response.json();
      const select = document.getElementById('maMatHang');
      select.innerHTML = '<option value="">Chọn mặt hàng</option>';
      
      matHangs.forEach(mh => {
        const option = document.createElement('option');
        option.value = mh.MaMatHang;
        option.textContent = mh.TenHang;
        select.appendChild(option);
      });
    } catch (error) {
      console.error('Lỗi tải mặt hàng:', error);
    }
  }

  async function loadNguyenLieuOptions() {
    try {
      const response = await fetch('http://localhost:3000/api/nguyenlieu');
      if (!response.ok) return;
      
      window.nguyenLieus = await response.json();
      
      // Cập nhật dropdown trong modal
      document.querySelectorAll('.nguyen-lieu-select').forEach(select => {
        select.innerHTML = '<option value="">Chọn nguyên liệu</option>' + 
          window.nguyenLieus.map(nl => 
            `<option value="${nl.MaNguyenLieu}">${nl.Ten} (${nl.DonVi})</option>`
          ).join('');
      });
    } catch (error) {
      console.error('Lỗi tải nguyên liệu:', error);
    }
  }

  // Tương tự cho các chức năng quản lý nhân viên và khách hàng
  // (Do khuôn khổ, tôi chỉ hiển thị chi tiết cho 2 chức năng đầu)
  </script>
  
  <!-- Modal chi tiết đơn hàng -->
  <div class="modal fade" id="donHangDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-file-invoice me-2"></i>Chi tiết đơn hàng</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="donHangDetailContent">
          <!-- Nội dung chi tiết sẽ được thêm ở đây -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal thêm/sửa nguyên liệu -->
  <div class="modal fade" id="addNguyenLieuModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="nguyenLieuModalTitle">Thêm nguyên liệu mới</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="nguyenLieuForm">
            <input type="hidden" id="nguyenLieuId">
            <div class="form-group">
              <label for="tenNguyenLieu" class="form-label">Tên nguyên liệu</label>
              <input type="text" class="form-control form-control-modern" id="tenNguyenLieu" required>
            </div>
            <div class="form-group">
              <label for="soLuong" class="form-label">Số lượng tồn kho</label>
              <input type="number" class="form-control form-control-modern" id="soLuong" required min="0">
            </div>
            <div class="form-group">
              <label for="donVi" class="form-label">Đơn vị tính</label>
              <input type="text" class="form-control form-control-modern" id="donVi" required>
            </div>
            <div class="form-group">
              <label for="giaNhap" class="form-label">Giá nhập (VNĐ)</label>
              <input type="number" class="form-control form-control-modern" id="giaNhap" required min="0">
            </div>
            <div class="form-group">
              <label for="hanSuDung" class="form-label">Hạn sử dụng</label>
              <input type="date" class="form-control form-control-modern" id="hanSuDung">
            </div>
            <div class="form-group">
              <label for="ghiChuNL" class="form-label">Ghi chú</label>
              <textarea class="form-control form-control-modern" id="ghiChuNL" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          <button type="button" class="btn btn-primary-modern" id="saveNguyenLieuBtn">Lưu lại</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal thêm/sửa công thức -->
  <div class="modal fade" id="addCongThucModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="congThucModalTitle">Thêm công thức mới</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="congThucForm">
            <input type="hidden" id="congThucId">
            <div class="form-group">
              <label for="maMatHang" class="form-label">Mặt hàng</label>
              <select class="form-select form-control-modern" id="maMatHang" required>
                <option value="">Chọn mặt hàng</option>
                <!-- Options sẽ được điền bằng JS -->
              </select>
            </div>
            <div class="form-group">
              <label for="tenCongThuc" class="form-label">Tên công thức</label>
              <input type="text" class="form-control form-control-modern" id="tenCongThuc" required>
            </div>
            <div class="form-group">
              <label for="moTaCongThuc" class="form-label">Mô tả công thức</label>
              <textarea class="form-control form-control-modern" id="moTaCongThuc" rows="3"></textarea>
            </div>
            
            <div class="card mt-4">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-list me-2"></i>Thành phần nguyên liệu</h6>
              </div>
              <div class="card-body">
                <div id="nguyenLieuContainer">
                  <div class="row mb-3 nguyen-lieu-item">
                    <div class="col-md-5">
                      <select class="form-select form-control-modern nguyen-lieu-select">
                        <option value="">Chọn nguyên liệu</option>
                        <!-- Options sẽ được điền bằng JS -->
                      </select>
                    </div>
                    <div class="col-md-3">
                      <input type="number" class="form-control form-control-modern so-luong" min="0.01" step="0.01" placeholder="Số lượng">
                    </div>
                    <div class="col-md-3">
                      <input type="text" class="form-control form-control-modern don-vi" placeholder="Đơn vị">
                    </div>
                    <div class="col-md-1">
                      <button type="button" class="btn btn-danger btn-sm remove-item">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <button type="button" id="addNguyenLieuBtn" class="btn btn-sm btn-primary mt-2">
                  <i class="fas fa-plus me-1"></i>Thêm nguyên liệu
                </button>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
          <button type="button" class="btn btn-primary-modern" id="saveCongThucBtn">Lưu công thức</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
<!--
cd C:\restaurant-management\backend
npm install express mysql2 cors body-parser dotenv
node app.js
-->